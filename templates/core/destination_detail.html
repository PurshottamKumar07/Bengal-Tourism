{% extends 'base.html' %}
{% load static %}

{% block title %}
  {{ destination.name }} | West Bengal Tourism
{% endblock %}

{% block hero_section %}
  <section class="hero-wrap hero-wrap-2 js-fullheight"
    style="background-image: url('{% if destination.image %}
      {{ destination.image.url }}
    {% else %}
      {% static 'images/bg_1.jpg' %}
    {% endif %}');">
    <div class="overlay"></div>
    <div class="container">
      <div class="row no-gutters slider-text js-fullheight align-items-end justify-content-center">
        <div class="col-md-9 ftco-animate pb-5 text-center">
          <p class="breadcrumbs">
            <span class="mr-2"><a href="{% url 'index' %}">Home <i class="fa fa-chevron-right"></i></a></span> <span>Destination <i class="fa fa-chevron-right"></i></span>
          </p>
          <h1 class="mb-0 bread">{{ destination.name }}</h1>
        </div>
      </div>
    </div>
  </section>
{% endblock %}

{% block content %}
  <section class="ftco-section">
    <div class="container">
      <div class="row">
        <div class="col-md-8">
          <img src="{{ destination.image.url }}" class="img-fluid mb-4" alt="{{ destination.name }}" />
          <p>{{ destination.description }}</p>

          {% if destination.map_image %}
            <div class="mt-4">
              <button class="btn btn-primary" data-toggle="modal" data-target="#miniMapModal">View Mini Map</button>
            </div>
          {% endif %}
        </div>
        <div class="col-md-4">
          <div class="p-4 bg-light">
            <h4 class="mb-3">Details</h4>
            <p>
              <strong>Location:</strong> {{ destination.location }}
            </p>
            <p>
              <strong>Duration:</strong> {{ destination.duration }} days
            </p>
            <p>
              <strong>Price:</strong> ₹{{ destination.price_per_person }}/person
            </p>
          </div>
        </div>
      </div>
    </div>
  </section>
  {% if destination.map_image %}
    <div class="modal fade" id="miniMapModal" tabindex="-1" role="dialog" aria-labelledby="miniMapModalLabel" aria-hidden="true">
      <div class="modal-dialog modal-lg" role="document">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title" id="miniMapModalLabel">{{ destination.name }} — Mini Map</h5>
            <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
          </div>
          <div class="modal-body">
            <div class="position-relative" style="width: 100%;">
              <img src="{{ destination.map_image.url }}" alt="Mini Map" class="img-fluid w-100" />
              {% for poi in pois %}
                <a href="{{ poi.google_maps_url }}" target="_blank" class="poi-marker" style="position: absolute; left: {{ poi.x_percent }}%; top: {{ poi.y_percent }}%; transform: translate(-50%, -100%); text-decoration: none;" title="{{ poi.name }}"><span class="badge badge-danger">{{ forloop.counter }}</span></a>
              {% endfor %}
            </div>
            {% if pois %}
              <div class="mt-3">
                <h6>Places</h6>
                <ol class="pl-3">
                  {% for poi in pois %}
                    <li>
                      <a href="{{ poi.google_maps_url }}" target="_blank">{{ poi.name }}</a>{% if poi.description %}
                        — {{ poi.description }}
                      {% endif %}
                    </li>
                  {% endfor %}
                </ol>
              </div>
            {% endif %}
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
          </div>
        </div>
      </div>
    </div>
  {% endif %}
{% endblock %}
