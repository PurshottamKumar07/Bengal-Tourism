{% extends 'base.html' %}
{% load static %}

{% block title %}
  Travel Agency | West Bengal Tourism
{% endblock %}

{% block extra_css %}
  <style>
    .nav-pills .nav-link {
      border-radius: 25px;
      margin: 0 5px;
      padding: 12px 24px;
      font-weight: 600;
      transition: all 0.3s ease;
    }
    
    .nav-pills .nav-link.active {
      background-color: #f96d00;
      color: white;
    }
    
    .nav-pills .nav-link:not(.active) {
      background-color: #f8f9fa;
      color: #333;
      border: 2px solid #e9ecef;
    }
    
    .nav-pills .nav-link:hover:not(.active) {
      background-color: #e9ecef;
      border-color: #f96d00;
    }
    
    .tab-content {
      padding: 20px 0;
    }
    
    .card {
      transition: transform 0.3s ease, box-shadow 0.3s ease;
    }
    
    .card:hover {
      transform: translateY(-5px);
      box-shadow: 0 10px 25px rgba(0, 0, 0, 0.15);
    }
  </style>
{% endblock %}

{% block hero_section %}
  <section class="hero-wrap hero-wrap-2 js-fullheight" style="background-image: url('{% static 'images/bg_1.jpg' %}');">
    <div class="overlay"></div>
    <div class="container">
      <div class="row no-gutters slider-text js-fullheight align-items-end justify-content-center">
        <div class="col-md-9 ftco-animate pb-5 text-center">
          <p class="breadcrumbs">
            <span class="mr-2"><a href="{% url 'index' %}">Home <i class="fa fa-chevron-right"></i></a></span> <span>Hotel <i class="fa fa-chevron-right"></i></span>
          </p>
          <h1 class="mb-0 bread">Agency</h1>
        </div>
      </div>
    </div>
  </section>
{% endblock %}

{% block content %}
  <!-- Agency Registration Section -->
  <section class="ftco-section ftco-no-pt">
    <div class="container">
      <div class="row">
        <div class="col-md-12">
          <div class="search-wrap-1 ftco-animate">
            <form action="#" class="search-property-1">
              <div class="row no-gutters">
                <div class="col-lg d-flex">
                  <div class="form-group p-4 border-0">
                    <label>Destination</label>
                    <div class="form-field">
                      <div class="icon">
                        <span class="fa fa-search"></span>
                      </div>
                      <input type="text" class="form-control" placeholder="Search place" />
                    </div>
                  </div>
                </div>
                <div class="col-lg d-flex">
                  <div class="form-group p-4">
                    <label>Check-in date</label>
                    <div class="form-field">
                      <div class="icon">
                        <span class="fa fa-calendar"></span>
                      </div>
                      <input type="text" class="form-control checkin_date" placeholder="Check In Date" />
                    </div>
                  </div>
                </div>
                <div class="col-lg d-flex">
                  <div class="form-group p-4">
                    <label>Check-out date</label>
                    <div class="form-field">
                      <div class="icon">
                        <span class="fa fa-calendar"></span>
                      </div>
                      <input type="text" class="form-control checkout_date" placeholder="Check Out Date" />
                    </div>
                  </div>
                </div>
                <div class="col-lg d-flex">
                  <div class="form-group p-4">
                    <label>Price Limit</label>
                    <div class="form-field">
                      <div class="select-wrap">
                        <div class="icon">
                          <span class="fa fa-chevron-down"></span>
                        </div>
                        <select class="form-control">
                          <option value="">$5,000</option>
                          <option value="">$10,000</option>
                          <option value="">$50,000</option>
                          <option value="">$100,000</option>
                          <option value="">$200,000</option>
                          <option value="">$300,000</option>
                          <option value="">$400,000</option>
                          <option value="">$500,000</option>
                          <option value="">$600,000</option>
                          <option value="">$700,000</option>
                          <option value="">$800,000</option>
                          <option value="">$900,000</option>
                          <option value="">$1,000,000</option>
                          <option value="">$2,000,000</option>
                        </select>
                      </div>
                    </div>
                  </div>
                </div>
                <div class="col-lg d-flex">
                  <div class="form-group d-flex w-100 border-0">
                    <div class="form-field w-100 align-items-center d-flex">
                      <input type="submit" value="Search" class="align-self-stretch form-control btn btn-primary" />
                    </div>
                  </div>
                </div>
              </div>
            </form>
          </div>
        </div>
      </div>
    </div>
  </section>

  <!-- Travel Agency Services Tabs -->
  <section class="ftco-section ftco-no-pt">
    <div class="container">
      <!-- Tab Navigation -->
      <div class="row justify-content-center mb-4">
        <div class="col-md-8">
          <ul class="nav nav-pills nav-fill" id="travelTabs" role="tablist">
            <li class="nav-item" role="presentation">
              <button class="nav-link active" id="agencies-tab" data-toggle="pill" data-target="#agencies" type="button" role="tab" aria-controls="agencies" aria-selected="true"><i class="fa fa-building"></i> Travel Agencies</button>
            </li>
            <li class="nav-item" role="presentation">
              <button class="nav-link" id="caravans-tab" data-toggle="pill" data-target="#caravans" type="button" role="tab" aria-controls="caravans" aria-selected="false"><i class="fa fa-car"></i> Caravan Rentals</button>
            </li>
          </ul>
        </div>
      </div>

      <!-- Tab Content -->
      <div class="tab-content" id="travelTabsContent">
        <!-- Travel Agencies Tab -->
        <div class="tab-pane fade show active" id="agencies" role="tabpanel" aria-labelledby="agencies-tab">
          <div class="row">
            <div class="col-md-12">
              <div class="row justify-content-center pb-4">
                <div class="col-md-12 heading-section text-center ftco-animate">
                  <span class="subheading">Travel Agencies</span>
                  <h2 class="mb-4">Partner Agencies</h2>
                </div>
              </div>

              {% if agencies %}
                <div class="row">
                  {% for agency in agencies %}
                    <div class="col-md-6 col-lg-4 mb-4">
                      <div class="card h-100">
                        <div class="card-body text-center">
                          <h5 class="card-title">{{ agency.name }}</h5>
                          <p class="card-text">{{ agency.description|truncatewords:20 }}</p>
                          <div class="mt-3">
                            <span class="badge badge-primary">{{ agency.location }}</span>
                            {% if agency.rating %}
                              <span class="badge badge-success">{{ agency.rating }} ★</span>
                            {% endif %}
                          </div>
                        </div>
                      </div>
                    </div>
                  {% endfor %}
                </div>
              {% else %}
                <div class="text-center">
                  <p>No travel agencies available at the moment.</p>
                </div>
              {% endif %}

              <!-- Agency Registration Form - Moved to Bottom -->
              <div class="row mt-5">
                <div class="col-md-8 mx-auto">
                  <div class="card">
                    <div class="card-header text-center" style="background: #f96d00; color: white;">
                      <h4 class="mb-0">Register Your Travel Agency</h4>
                    </div>
                    <div class="card-body">
                      {% if agency_reg_success %}
                        <div class="alert alert-success">
                          <i class="fa fa-check-circle"></i>
                          Your agency registration has been submitted successfully! We'll review and contact you soon.
                        </div>
                      {% endif %}

                      <form method="post" enctype="multipart/form-data">
                        {% csrf_token %}
                        {{ agency_form.as_p }}
                        <button type="submit" class="btn btn-primary btn-block" style="background: #f96d00; border-color: #f96d00;">Register Agency</button>
                      </form>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- Caravans Tab -->
        <div class="tab-pane fade" id="caravans" role="tabpanel" aria-labelledby="caravans-tab">
          <div class="row">
            <div class="col-md-12">
              <div class="row justify-content-center pb-4">
                <div class="col-md-12 heading-section text-center ftco-animate">
                  <span class="subheading">Caravan Rentals</span>
                  <h2 class="mb-4">Explore West Bengal in Comfort</h2>
                  <p>Choose from our premium selection of caravans for your next adventure</p>
                </div>
              </div>

              <!-- Featured Caravans -->
              {% if featured_caravans %}
                <div class="row">
                  {% for caravan in featured_caravans %}
                    <div class="col-md-6 col-lg-4 mb-4">
                      <div class="card h-100" style="border-radius: 15px; overflow: hidden; box-shadow: 0 5px 15px rgba(0,0,0,0.1);">
                        <div class="position-relative">
                          <img src="{% if caravan.featured_image %}
                              {{ caravan.featured_image.url }}
                            {% else %}
                              {% static 'images/services-1.jpg' %}
                            {% endif %}"
                            class="card-img-top"
                            alt="{{ caravan.name }}"
                            style="height: 200px; object-fit: cover;" />
                          <span class="badge badge-primary" style="position: absolute; top: 15px; right: 15px; background: #f96d00; padding: 8px 12px; border-radius: 20px;">{{ caravan.get_caravan_type_display }}</span>
                        </div>
                        <div class="card-body">
                          <h5 class="card-title">{{ caravan.name }}</h5>
                          <p class="card-text">{{ caravan.short_description|truncatewords:15 }}</p>

                          <div class="row mb-3">
                            <div class="col-6">
                              <small class="text-muted"><i class="fa fa-users"></i> {{ caravan.capacity }} People</small>
                            </div>
                            <div class="col-6">
                              <small class="text-muted"><i class="fa fa-bed"></i> {{ caravan.beds }} Beds</small>
                            </div>
                          </div>

                          <div class="d-flex justify-content-between align-items-center">
                            <span class="badge badge-warning" style="background: #f96d00; color: white; padding: 8px 16px; border-radius: 20px; font-size: 14px;">₹{{ caravan.daily_rate|floatformat:0 }}/day</span>
                            <a href="{% url 'caravan_detail' caravan.slug %}" class="btn btn-outline-primary btn-sm">View Details</a>
                          </div>
                        </div>
                      </div>
                    </div>
                  {% endfor %}
                </div>

                <!-- View All Caravans Button -->
                <div class="row mt-4">
                  <div class="col text-center">
                    <a href="{% url 'caravan_list' %}" class="btn btn-primary btn-lg" style="background: #f96d00; border-color: #f96d00;"><i class="fa fa-car"></i> View All Caravans</a>
                  </div>
                </div>
              {% else %}
                <div class="text-center">
                  <p>No caravans available at the moment.</p>
                </div>
              {% endif %}
            </div>
          </div>
        </div>
      </div>
    </div>
  </section>

  <section class="ftco-section">
    <div class="container">
      <div class="row">
        {% for i in '123456789'|make_list %}
          <div class="col-md-4 ftco-animate">
            <div class="project-wrap hotel">
              <a href="#" class="img" style="background-image: url('{% static 'images/hotel-resto-' %}{{ forloop.counter }}.jpg');">
                <span class="price">
                  $200/{% if forloop.counter == 9 %}
                    night
                  {% else %}
                    person
                  {% endif %}
                </span>
              </a>
              <div class="text p-4">
                <p class="star mb-2">
                  <span class="fa fa-star"></span>
                  <span class="fa fa-star"></span>
                  <span class="fa fa-star"></span>
                  <span class="fa fa-star"></span>
                  <span class="fa fa-star"></span>
                </p>
                <span class="days">{{ 3|add:forloop.counter }} Days Tour</span>
                <h3><a href="#">Sample Hotel {{ forloop.counter }}</a></h3>
                <p class="location">
                  <span class="fa fa-map-marker"></span> Sample City
                </p>
                <ul>
                  <li>
                    <span class="flaticon-shower"></span>2
                  </li>
                  <li>
                    <span class="flaticon-king-size"></span>3
                  </li>
                  <li>
                    <span class="flaticon-sun-umbrella"></span>Near Beach
                  </li>
                </ul>
              </div>
            </div>
          </div>
        {% endfor %}
      </div>
    </div>
  </section>
{% endblock %}

{% block extra_js %}
  <script>
    $(document).ready(function () {
      // Initialize Bootstrap tabs
      $('#travelTabs a').on('click', function (e) {
        e.preventDefault()
        $(this).tab('show')
      })
    
      // Add smooth transitions
      $('.nav-pills .nav-link').on('click', function () {
        $('.tab-pane').fadeOut(200)
        setTimeout(function () {
          $('.tab-pane.active').fadeIn(200)
        }, 200)
      })
    })
  </script>
{% endblock %}
